# 隐私保护的分布式机器学习系统

## 参数服务器：

维护global_model

与参与者交流

### 数据维护：

global_model的参数

维护梯度池（多个参与者同时发来梯度信息）

### 方法：

#### 接受参与请求 与参与者建立通信

#### 模型下发

#### 接收参数更新请求 参数更新

### 线程：

#### 1.端口监听 网络通信线程

#### 2.梯度处理 后台数据处理线程  

## 参与者：

利用本地数据集训练本地模型

与参数服务器交流

### 数据维护：

本地数据集

本地模型参数

梯度

### 方法：

#### 发出请求 建立通信

#### 模型训练

#### 上传梯度



## 系统架构思想：

联邦学习服务器维护一个统一模型，参与者当想将自身拥有的数据加入学习过程，应与服务器产生联系，并沟通交互细节。连接建立成功后，服务器向参与者分享当前的模型，参与者在本地进行模型训练，并将梯度回传给服务器。服务器自行决定是否进行梯度更新。

拥有数据的参与者获得与服务器分享模型的机会。

采用有限自动机构建服务器与参与者之间沟通的状态定义。

New Idea： 去中心化架构，参与者构成信息流环，信息在参与者中限制拓扑流通？

## 进展日志

12.15 完善参数管理数据结构类 parameters； 

​			实现服务端通信类SokectServer：定义服务器与参与者的交互协议：

​			1、前四个字节作为控制信息： 1001请求参与，1002请求模型参数，1003确认模型类型，1004回馈梯度

​			参数服务器架构问题：

​					参数服务器包括：模型管理数据结构，网络通信数据结构

12.16 修改服务端架构，将网络管理类作为基础类

​			ndarry在MXnet中对Dense权值矩阵直接赋值[:]

​			编写参与者端的网络模块

​			服务端采用TCP二进制文件传输方式发送模型

12.17 初步完成参与者类Participant，待测试梯度更新方法，待确认服务器端多线程调度方算法

​			朴素联邦学习方法：单线程阻塞式，同一时间只允许单个参与者获取当前模型

​			初步采用训练集整体梯度作为局部梯度上传服务器（测试）

​			参与者梯度回传方法，pickle序列化字典，socket回传字典

​			梯度回传状态确认

​			TODO: 测试梯度获取方法，实现梯度端到端传递方法，实现globel model梯度更新

12.18 测试梯度计算方法，完善梯度发送的网络方法，完善朴素算法网络交互模块

​		   完成服务端parameters类中维护模型和梯度更新方法

​			TODO: 测试

12.22 添加测试方法

​			朴素方法单服务器单参与者测试成功

​			TODO: 多数据集学习测试，多机网络，提示信息优化。

12.25 participant类代码优化 优化代码结构 添加进度条

​			朴素方法多数据集测试： 0.92 0.93 0.89 0.83 0.71  失败  

​					原因：算法错误，服务端发送模型未更新。

​			TODO: 算法流程检查，多机训练测试

12.26  多轮训练结果失败，算法流程check，参与者端的模型接收函数出错

​			单机多轮训练结果成功, round5 validation rate: 0.93

​			version1.1 workable

12.30 TODO:《Privacy-Preserving Deep Learning》论文算法加入  version 2.0

​			需求分析，算法架构完成

1.2 着手添加SSGD算法模块，完成Selective Gradient Update部分函数

​		TODO：架构分析，模块优化

1.3 完成SSGD函数

​		TODO： 算法流程分析，单元测试

1.5 单元测试，算法流程检查与分析，代码review

--新年快乐--

1.27 代码复习，架构分析

模型自定义算法，服务器部署模型，客户端询问服务器模型结构，服务器动态生成模型结构生成代码，传回客户端。

2.2  代码重测 朴素算法无BUG

​		SSGD算法测试

2.3 架构思想添加：服务器核心架构，服务器部署，参与者端部署由服务器自动化部署，算法参数自定义，模型结构自定义。

​	代码架构合理化。

​	mxnet更新，朴素算法出现bug

2.5 修复朴素算法bug

​		TODO 测试SSGD参数选择模块，测试SSGD算法

​					实现动态自定义模型结构

2.6 修复SSGD流程算法，编写代码

2.7 成功跑通SSGD流程算法，但计算效率低，准确率不提升

​		TODO：check算法流程，修改代码结构，测试准确率参数

2.16 添加json文件自定义配置系统参数；

​		研究mxnet框架下，自定义神经网络模型架构的方法及实现；（同jison文件格式自定义，读取json内容）

​		系统架构更新，SocktServer类负责Server与Client的通信，param负责模型内部数据处理，通过初始化为不同的param产生不同的神经网络架构 NN,CNN,RNN等，相应的参数更新和发送也发生改变。

2.17 自定义网络架构中，将param作为负责模型内部处理，param类与自定义模型关系密切，将 param类改为可由用户继承重写，传入SocktServer类，作为成员，以此实现用户自定义模型。

​		将参与者类再抽象分为两个独立工作的类，类比服务器端架构，一个类作为维持网络通信，另一个类负责后台数据处理。

2.18 想法：实现UI，将用户自定义网络采用使用带ui程序定义生成json格式文件。

​					梯度传递为列表传递，顺序对应遍历神经网络层对应带参数的层。

2.19 重构代码，提高可拓展性，和用户自定义

​		重构架构：Server和Client端只集成朴素联邦学习算法，其他变形算法另外编写工具类应用

